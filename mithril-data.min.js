/**
 * mithril-data v0.2.9
 * A rich data model library for Mithril javascript framework.
 * https://github.com/rhaldkhein/mithril-data
 * (c) 2016 Kevin Villanueva
 * License: MIT
 */
!function(t){function e(i){if(n[i])return n[i].exports;var o=n[i]={exports:{},id:i,loaded:!1};return t[i].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){function i(t){function e(e,n){h.call(this,n);var i=(this.__options.parse?this.options.parser(e):e)||{},o=(t.refs,t.props);-1===r.indexOf(o,c.keyId)&&o.push(c.keyId);for(var s,u=0;u<o.length;u++){if(s=o[u],!this.__isProp(s)||"id"===s&&s!==c.keyId)return;if(r.hasIn(this,s)&&"id"!==s)throw new Error("`"+s+"` prop is not allowed.");this[s]=this.__gettersetter(r.isUndefined(i[s])?t.defaults[s]:i[s],s)}}o(t);var n=f.isConflictExtend(h.prototype,t.methods);if(n)throw new Error("`"+n+"` method is not allowed.");return e.modelOptions=t,e.prototype=r.create(h.prototype,r.assign(t.methods||{},{options:t})),Object.setPrototypeOf(e,l.prototype),e}function o(t){t.defaults=t.defaults||{},t.props=r.union(t.props||[],r.keys(t.defaults)),t.refs=t.refs||{},t.parser=t.parser||function(t){return t}}var s,r=n(1),u=n(2),c=n(3).config,a=n(3).modelConstructors,h=n(4),l=n(10),f=n(6),d=n(8);Object.setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},e.version=function(){return"v0.2.9"},e.Collection=n(8),e.State=n(9),e.store=n(5),e.model=function(t,e){if(t=t||{},e=e||{},!t.name)throw new Error("Model name must be set.");var n=a[t.name]=i(t);return n.__init(e),n},e.model.get=function(t){return a[t]};var p={};e.config=function(t){r.assign(c,t),c.modelMethods&&f.strictExtend(h.prototype,c.modelMethods),c.constructorMethods&&f.strictExtend(l.prototype,c.constructorMethods),c.collectionMethods&&f.strictExtend(d.prototype,c.collectionMethods),c.modelMethods=null,c.constructorMethods=null,c.collectionMethods=null},e.resetConfig=function(){f.clearObject(c),e.config(p)},e.defaultConfig=function(t,n){r.assign(p,t),n||e.resetConfig()},e.defaultConfig({baseUrl:"",keyId:"id",store:u.request,redraw:!1}),s=function(){return e}.call(e,n,e,t),!(void 0!==s&&(t.exports=s)),"undefined"!=typeof window&&(e.noConflict=function(){return oldObject&&(window.md=oldObject,oldObject=null),window.md},window.__TEST__&&window.mocha&&window.chai&&(e.__TEST__={config:c,BaseModel:h,ModelConstructor:l}),window.md&&(oldObject=window.md),window.md=e)},function(t,e){t.exports=_},function(t,e){t.exports=m},function(t,e){e.config={},e.modelConstructors={}},function(t,e,n){function i(t){this.__options={redraw:!1,parse:!0},this.__collections=[],this.__lid=o.uniqueId("model"),this.__saved=!1,this.__json={__model:this},o.bindAll(this,o.union(l,r.modelBindMethods)),t&&this.opt(t)}var o=n(1),s=n(2),r=n(3).config,u=n(3).modelConstructors;t.exports=i;var c=n(5),a=n(6),h=n(8),l=[],f={has:1,keys:0,values:0,pick:1,omit:1};i.prototype={opt:function(t,e){o.isPlainObject(t)?o.assign(this.__options,t):this.__options[t]=o.isUndefined(e)?!0:e},id:function(t){return t?this[r.keyId](t,!0):this[r.keyId]()},lid:function(){return this.__lid},url:function(){return r.baseUrl+(this.options.url||"/"+this.options.name.toLowerCase())},attachCollection:function(t){if(!(t instanceof h))throw new Error("Argument `collection` must be instance of Collection.");var e=t.get(this);e&&-1===o.indexOf(this.__collections,t)?this.__collections.push(t):t.add(this)},detachCollection:function(t){if(!(t instanceof h))throw new Error("Argument `collection` must be instance of Collection.");t.get(this)&&t.remove(this),o.indexOf(this.__collections,t)>-1&&o.pull(this.__collections,t)},set:function(t,e,n){o.isString(t)?this[t](e,n):this.setObject(t,n)},setObject:function(t,e){var n=t instanceof i;if(!n&&!o.isPlainObject(t))throw new Error("Argument `obj` must be a model or plain object.");for(var s,r,u=!n&&this.__options.parse?this.options.parser(t):t,c=o.keys(u),a=c.length-1;a>=0;a--){if(s=c[a],r=u[s],!this.__isProp(s)||!o.isFunction(this[s]))return;n&&o.isFunction(r)?this[s](r(),!0):this[s](r,!0)}e||this.__update()},get:function(t){return t?this[t]():this.getCopy()},getJson:function(){return this.__json},getCopy:function(t){for(var e,n,s={},r=o.keys(this.__json),u=0;u<r.length;u++)e=r[u],n=this.__json[e],this.__isProp(e)&&(n&&n.__model instanceof i?s[e]=n.__model.get():s[e]=n);return t?o.cloneDeep(s):s},save:function(t,e){o.isFunction(t)&&(e=t,t=void 0);var n=this,i=s.deferred(),r=this.id()?c.put:c.post;return r.call(c,this.url(),this,t).then(function(s){n.set(t&&t.path?o.get(s,t.path):s),n.__saved=!0,i.resolve(n),o.isFunction(e)&&e(null,s,n)},function(t){i.reject(t),o.isFunction(e)&&e(t)}),i.promise},fetch:function(t,e){o.isFunction(t)&&(e=t,t=void 0);var n=this,i=s.deferred(),u=this.__getDataId();return u[r.keyId]?c.get(this.url(),u,t).then(function(s){n.set(t&&t.path?o.get(s,t.path):s),n.__saved=!0,i.resolve(n),o.isFunction(e)&&e(null,s,n)},function(t){i.reject(t),o.isFunction(e)&&e(t)}):(i.reject(!0),o.isFunction(e)&&e(!0)),i.promise},destroy:function(t,e){o.isFunction(t)&&(e=t,t=void 0);var n=this,i=s.deferred(),u=this.__getDataId();return u[r.keyId]?c.destroy(this.url(),u,t).then(function(){n.detach(),i.resolve(),o.isFunction(e)&&e(null),n.dispose()},function(t){i.reject(t),o.isFunction(e)&&e(t)}):(i.reject(!0),o.isFunction(e)&&e(!0)),i.promise},remove:function(){this.detach(),this.dispose()},detach:function(){for(var t=o.clone(this.__collections),e=0;e<t.length;e++)t[e].remove(this),t[e]=null},dispose:function(){var t,e=o.keys(this),n=this.options.props;for(this.__json.__model=null,t=0;t<n.length;t++)this[n[t]](null);for(t=0;t<e.length;t++)this[e[t]]=null},isSaved:function(){return this.__saved},isNew:function(){return!(this.id()&&this.__saved)},__update:function(t){var e;(this.__options.redraw||this.options.redraw||r.redraw)&&(s.startComputation(),e=!0);for(var n=0;n<this.__collections.length;n++)this.__collections[n].__update(this);e&&a.nextTick(s.endComputation)},__isProp:function(t){return o.indexOf(this.options.props,t)>-1},__getDataId:function(){var t={};return t[r.keyId]=this.id(),t},__gettersetter:function(t,e){function n(){var t;return arguments.length?(t=arguments[0],o.isPlainObject(t)&&r&&(t=u[r].create(t)),t instanceof i&&(t=t.getJson()),s[e]=t,arguments[1]||this.__update(e),t):(t=s[e],t&&t.__model instanceof i?t=t.__model:o.isNil(t)&&this.options&&!o.isNil(this.options.defaults[e])&&(t=this.options.defaults[e]),t)}var s=this.__json,r=this.options.refs[e];return n.toJSON=function(){return s[e]},n(t,!0),n}},a.addMethods(i.prototype,o,f,"__json")},function(t,e,n){function i(t,e){c.storeConfigXHR&&c.storeConfigXHR(t,e),t.setRequestHeader("Content-Type","application/json")}function o(t,e){return c.storeExtract?c.storeExtract(t,e):t.responseText.length?t.responseText:null}function s(t){return t=t instanceof a?t.getCopy():t,c.storeSerializer?c.storeSerializer(t):JSON.stringify(t)}function r(t){if(c.storeDeserializer)return c.storeDeserializer(t);try{return JSON.parse(t)}catch(e){return t}}var u=n(1),c=n(3).config,a=n(4);t.exports=u.create(null,{request:function(t,e,n,a){var h={method:e||"GET",url:t,data:n||{},serialize:s,deserialize:r,config:i,extract:o};return a&&u.assign(h,a),c.storeConfigOptions&&c.storeConfigOptions(h),c.store(h)},get:function(t,e,n){return this.request(t,"GET",e,n)},post:function(t,e,n){return this.request(t,"POST",e,n)},put:function(t,e,n){return this.request(t,"PUT",e,n)},destroy:function(t,e,n){return this.request(t,"DELETE",e,n)}})},function(t,e,n){(function(e){function i(t,e){return function(n,i,o,s){return t(n?n[e]||n:n,i?i[e]||i:i,o,s)}}function o(t,e){for(var n,o=t.length-1;o>=0;o--)n=t[o],u.isFunction(n)?t[o]=i(n,e):n instanceof a&&(t[o]=n.__json);return t}function s(t,e,n){if(t===e)return t;if(u.isArray(t)){for(var i,o=t.length-1;o>=0;o--)i=t[o],i&&i[n]&&(t[o]=i[n]);return t}return t?t[n]||t:t}function r(){return h&&window.setImmediate?window.setImmediate:"object"==typeof e&&"function"==typeof e.nextTick?e.nextTick:function(t){setTimeout(t,0)}}var u=n(1),c=Array.prototype.slice,a=n(4),h="undefined"!=typeof window;t.exports=u.create(null,{isBrowser:h,nextTick:r(),clearObject:function(t){for(var e in t)delete t[e]},hasValueOfType:function(t,e){for(var n=u.keys(t),i=0;i<n.length;i++)if(t[n[i]]instanceof e)return!0;return!1},isConflictExtend:function(t,e,n){for(var i=u.keys(e),o=0;o<i.length;o++)if(u.hasIn(t,i[o]))return i[o];return!1},strictExtend:function(t,e){var n=this.isConflictExtend(t,e);if(n)throw new Error("`"+n+"` method / property is not allowed.");u.extend(t,e)},addMethods:function(t,e,n,r,h){u.each(n,function(n,l){if(e[l])switch(n){case 0:t[l]=function(){return s(e[l](this[r]),this[r],h)};break;case 1:t[l]=function(t){return u.isFunction(t)?t=i(t,h):t instanceof a&&(t=t.__json),s(e[l](this[r],t),this[r],h)};break;case 2:t[l]=function(t,n){return u.isFunction(t)?t=i(t,h):t instanceof a&&(t=t.__json),u.isFunction(n)?n=i(n,h):n instanceof a&&(n=n.__json),s(e[l](this[r],t,n),this[r],h)};break;default:t[l]=function(){var t=o(c.call(arguments),h);return t.unshift(this[r]),s(e[l].apply(e,t),this[r],h)}}})}})}).call(e,n(7))},function(t,e){function n(){a&&r&&(a=!1,r.length?c=r.concat(c):h=-1,c.length&&i())}function i(){if(!a){var t=setTimeout(n);a=!0;for(var e=c.length;e;){for(r=c,c=[];++h<e;)r&&r[h].run();h=-1,e=c.length}r=null,a=!1,clearTimeout(t)}}function o(t,e){this.fun=t,this.array=e}function s(){}var r,u=t.exports={},c=[],a=!1,h=-1;u.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];c.push(new o(t,e)),1!==c.length||a||setTimeout(i,0)},o.prototype.run=function(){this.fun.apply(null,this.array)},u.title="browser",u.browser=!0,u.env={},u.argv=[],u.version="",u.versions={},u.on=s,u.addListener=s,u.once=s,u.off=s,u.removeListener=s,u.removeAllListeners=s,u.emit=s,u.binding=function(t){throw new Error("process.binding is not supported")},u.cwd=function(){return"/"},u.chdir=function(t){throw new Error("process.chdir is not supported")},u.umask=function(){return 0}},function(t,e,n){function i(t){this.models=[],this.__options={redraw:!1},t&&this.opt(t);var e=this.__options.state;e&&(e instanceof a||(e=new a(e)),this.__state=e),o.bindAll(this,o.union(h,u.collectionBindMethods))}var o=n(1),s=n(2),r=n(6),u=n(3).config,c=n(4),a=n(9);t.exports=i,i.prototype={opt:function(t,e){o.isPlainObject(t)?o.assign(this.__options,t):this.__options[t]=o.isUndefined(e)?!0:e},add:function(t,e,n){if(!(t instanceof c)||this.__options.model&&!(t instanceof this.__options.model))throw new Error("Must be a model or an instance of set model");var i=this.get(t),o=!1;return i?i.set(t):(e?this.models.unshift(t.getJson()):this.models.push(t.getJson()),t.attachCollection(this),this.__state&&this.__state.set(t.lid()),o=!0),o&&!n&&this.__update(),o},addAll:function(t,e,n){o.isArray(t)||(t=[t]);for(var i=!1,s=0;s<t.length;s++)this.add(t[s],e,!0)&&(i=!0);return i&&!n&&this.__update(),i},create:function(t,e){o.isArray(t)||(t=[t]);for(var n,i,s=[],r=0;r<t.length;r++){if(i=t[r],!o.isPlainObject(i))throw new Error("Plain object required");n=this.get(i),n?n.set(i,!0):this.__options.model&&s.push(this.__options.model.create(i,e))}return this.addAll(s),s},get:function(t){var e;if(t instanceof c)return this.contains(t)?t:void 0;if(o.isObject(t)){if(!t[u.keyId])return this.find(t)||void 0;t=t[u.keyId]}return e=this.find([u.keyId,t]),e||void 0},getAll:function(t,e){o.isArray(t)||(t=[t]);for(var n,i=[],s=0;s<t.length;s++)n=this.get(t[s]),(n||e)&&i.push(n);return i},remove:function(t,e){o.isArray(t)||(t=[t]);var n,i,s,r=this.size(),a=[];if(r){for(s=0;s<t.length;s++){if(i=t[s],!i)throw new Error("Can't remove from collection. Argument must be set.");i instanceof c?a.push.apply(a,o.remove(this.models,function(t){return o.eq(t,i.getJson())})):o.isObjectLike(i)?a.push.apply(a,o.remove(this.models,function(t){return o.isMatch(t,i)})):a.push.apply(a,o.remove(this.models,function(t){return n={},n[u.keyId]=i,o.isMatch(t,n)}))}var h;for(s=0;s<a.length;s++)h=a[s].__model,h.detachCollection(this),this.__state&&this.__state.remove(h.lid());return r!==this.size()?(e||this.__update(),!0):!1}},push:function(t,e){return this.addAll(t,e)},unshift:function(t,e){return this.addAll(t,!0,e)},shift:function(t){var e=this.first();return this.remove(e,t),e},pop:function(t){var e=this.last();return this.remove(e,t),e},clear:function(t){return this.remove(this.toArray(),t)},pluck:function(t){for(var e=[],n="id"===t,i=0,o=this.models;i<o.length;i++)e.push(n?o[i].__model[t]():o[i][t]);return e},dispose:function(){var t=o.keys(this),e=0;for(this.__options.model&&(this.__options.model=null);e<t.length;e++)this[t[e]]=null},destroy:function(){this.clear(!0),this.dispose()},stateOf:function(t){if(this.__state){var e=this.get(t);if(e)return this.__state.get(e.lid())}},contains:function(t){if(t instanceof c)return this.indexOf(t.getJson())>-1;if(o.isObject(t)){if(!t[u.keyId])return this.findIndex(t)>-1;t=t[u.keyId]}return this.findIndex([u.keyId,t])>-1},sort:function(t,e){o.isArray(t)||(t=[t]);var n;e?(o.isArray(e)||(e=[e]),n=this.orderBy(t,e)):n=this.orderBy(t),this.__replaceModels(n)},randomize:function(){this.__replaceModels(this.shuffle())},hasModel:function(){return!!this.__options.model},model:function(){return this.__options.model},url:function(t){var e=t?"":u.baseUrl;return this.__options.url?e+=this.__options.url:this.hasModel()&&(e+=this.model().modelOptions.url||"/"+this.model().modelOptions.name.toLowerCase()),e},fetch:function(t,e,n){o.isFunction(e)&&(n=e,e=void 0);var i=s.deferred();if(this.hasModel()){var r=this;e=e||{},this.model().pull(this.url(),t,e,function(t,e,s){t?(i.reject(t),o.isFunction(n)&&n(t)):(r.addAll(s),i.resolve(s),o.isFunction(n)&&n(null,e,s))})}else i.reject(!0),o.isFunction(n)&&n(!0);return i.promise},__replaceModels:function(t){for(var e=t.length-1;e>=0;e--)this.models[e]=t[e].__json},__update:function(){(this.__options.redraw||u.redraw)&&(s.startComputation(),r.nextTick(s.endComputation))}};var h=[],l={difference:1,every:1,find:1,findIndex:1,findLastIndex:1,filter:1,first:0,forEach:1,indexOf:2,initial:0,invoke:3,groupBy:1,last:0,lastIndexOf:2,map:1,maxBy:1,minBy:1,nth:1,orderBy:2,reject:1,reverse:0,sample:0,shuffle:0,size:0,slice:1,sortBy:1,some:1,transform:2,toArray:0,without:1};r.addMethods(i.prototype,o,l,"models","__model")},function(t,e,n){function i(){var t={};for(var e in this)-1===r.indexOf(a,e)&&(t[e]=this[e]());return t}function o(t,e){var n;for(var i in t){if(r.indexOf(a,i)>-1)throw new Error("State key `"+i+"` is not allowed.");n=t[i],e[i]=r.isFunction(n)?n:u.prop(n)}return e}function s(t){if(r.isArray(t)){this.signature=r.invert(t);for(var e in this.signature)this.signature[e]=void 0}else this.signature=t;this.map={}}var r=n(1),u=n(2),c="__key__",a=["toJson","factory"];t.exports=s,s.create=function(t){return o(t,{toJson:i})},s.prototype={set:function(t){return t||(t=c),this.map[t]||(this.map[t]=o(this.signature,{factory:u.prop(this),toJson:i})),this.map[t]},get:function(t){return t||(t=c),this.map[t]||this.set(t),this.map[t]},remove:function(t){if(t||(t=c),this.map[t]){var e,n=r.keys(this.map[t]);for(e=0;e<n.length;e++)this.map[t][n[e]]=null;delete this.map[t]}},dispose:function(){var t,e,n=r.keys(this),i=r.keys(this.map),o=r.keys(this.signature);for(t=0;t<i.length;t++){for(e=0;e<o.length;e++)this.map[i[t]][o[e]]=null;this.map[i[t]]=null}for(t=0;t<n.length;t++)this[n[t]]=null}}},function(t,e,n){function i(){}var o=n(5),s=n(3).config,r=n(8);t.exports=i,i.prototype={__init:function(t){this.__options||(this.__options={redraw:!1,cache:s.cache===!0},t&&this.opt(t),this.__options.cache&&(this.__cacheCollection=new md.Collection({model:this})))},__flagSaved:function(t){for(var e=0;e<t.length;e++)t[e].__saved=!0},opt:function(t,e){this.__options||this.__init(),_.isPlainObject(t)?_.assign(this.__options,t):this.__options[t]=_.isUndefined(e)?!0:e},create:function(t,e){if(!_.isPlainObject(t))throw new Error("Plain object required");var n;return this.modelOptions.parser&&(t=this.modelOptions.parser(t)),this.__options.cache&&t[s.keyId]?(n=this.__cacheCollection.get(t),n||(n=new this(t,e),this.__cacheCollection.add(n))):n=new this(t,e),n},createCollection:function(t){return new r(_.assign({model:this},t))},createModels:function(t,e){_.isArray(t)||(t=[t]);for(var n=[],i=0;i<t.length;i++)n[i]=this.create(t[i],e);return n},pull:function(t,e,n,i){_.isFunction(e)?(i=e,e=void 0):_.isFunction(n)&&(i=n,n=e,e=void 0);var s=this,r=m.deferred();return o.get(t,e,n).then(function(t){var e=s.createModels(n&&n.path?_.get(t,n.path):t,n);s.__flagSaved(e),r.resolve(e),_.isFunction(i)&&i(null,t,e)},function(t){r.reject(t),_.isFunction(i)&&i(t)}),r.promise}}}]);