/**
 * mithril-data v0.2.0
 * A rich model library for Mithril javascript framework.
 * https://github.com/rhaldkhein/mithril-data
 * (c) 2016 Kevin Villanueva
 * License: MIT
 */
!function(t){function n(i){if(e[i])return e[i].exports;var o=e[i]={exports:{},id:i,loaded:!1};return t[i].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}var e={};return n.m=t,n.c=e,n.p="",n(0)}([function(t,n,e){function i(t){function n(n,e){var i=n||{},o=(t.refs,t.props);-1===s.indexOf(o,c.keyId)&&o.push(c.keyId),f.call(this,e);for(var r,u=0;u<o.length;u++){if(r=o[u],!this.__isProp(r)||"id"===r&&r!==c.keyId)return;if(s.hasIn(this,r)&&"id"!==r)throw new Error("`"+r+"` prop is not allowed.");this[r]=this.__gettersetter(s.isUndefined(i[r])?t.defaults[r]:i[r],r)}}o(t);var e=h.isConflictExtend(f.prototype,t.methods);if(e)throw new Error("`"+e+"` method is not allowed.");return n.modelOptions=t,n.prototype=s.create(f.prototype,s.assign(t.methods||{},{options:t})),Object.setPrototypeOf(n,l.prototype),n}function o(t){t.defaults=t.defaults||{},t.props=s.union(t.props||[],s.keys(t.defaults)),t.refs=t.refs||{}}var r,s=e(1),u=e(2),c=e(3).config,a=e(3).modelConstructors,f=e(4),l=e(10),h=e(6),d=e(8);Object.setPrototypeOf=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t},n.version=function(){return"v0.2.0"},n.Collection=e(8),n.State=e(9),n.store=e(5),n.model=function(t,n){if(t=t||{},n=n||{},!t.name)throw new Error("Model name must be set.");var e=a[t.name]=i(t);return e.__init(n),e},n.model.get=function(t){return a[t]};var p={};n.config=function(t){s.assign(c,t),c.modelMethods&&h.strictExtend(f.prototype,c.modelMethods),c.constructorMethods&&h.strictExtend(l.prototype,c.constructorMethods),c.collectionMethods&&h.strictExtend(d.prototype,c.collectionMethods),c.modelMethods=null,c.constructorMethods=null,c.collectionMethods=null},n.resetConfig=function(){h.clearObject(c),n.config(p)},n.defaultConfig=function(t,e){s.assign(p,t),e||n.resetConfig()},n.defaultConfig({baseUrl:"",keyId:"id",store:u.request,redraw:!1}),r=function(){return n}.call(n,e,n,t),!(void 0!==r&&(t.exports=r)),"undefined"!=typeof window&&(n.noConflict=function(){return oldObject&&(window.md=oldObject,oldObject=null),window.md},window.__TEST__&&window.mocha&&window.chai&&(n.__TEST__={config:c,BaseModel:f,ModelConstructor:l}),window.md&&(oldObject=window.md),window.md=n)},function(t,n){t.exports=_},function(t,n){t.exports=m},function(t,n){n.config={},n.modelConstructors={}},function(t,n,e){function i(t){this.__options={redraw:!1},this.__collections=[],this.__lid=o.uniqueId("model"),this.__saved=!1,this.__json={__model:this},o.bindAll(this,o.union(l,s.modelBindMethods)),t&&this.opt(t)}var o=e(1),r=e(2),s=e(3).config,u=e(3).modelConstructors;t.exports=i;var c=e(5),a=e(6),f=e(8),l=[],h={has:1,keys:0,values:0,pick:1,omit:1};i.prototype={opt:function(t,n){o.isPlainObject(t)?o.assign(this.__options,t):this.__options[t]=o.isUndefined(n)?!0:n},id:function(t){return t?this[s.keyId](t,!0):this[s.keyId]()},lid:function(){return this.__lid},url:function(){return s.baseUrl+(this.options.url||"/"+this.options.name.toLowerCase())},attachCollection:function(t){if(!(t instanceof f))throw new Error("Argument `collection` must be instance of Collection.");var n=t.get(this);n&&-1===o.indexOf(this.__collections,t)?this.__collections.push(t):t.add(this)},detachCollection:function(t){if(!(t instanceof f))throw new Error("Argument `collection` must be instance of Collection.");t.get(this)&&t.remove(this),o.indexOf(this.__collections,t)>-1&&o.pull(this.__collections,t)},set:function(t,n,e){var r=t instanceof i;if(r||o.isPlainObject(t)){for(var s,u,c=o.keys(t),a=c.length-1;a>=0;a--){if(s=c[a],u=t[s],!this.__isProp(s)||!o.isFunction(this[s]))return;r&&o.isFunction(u)?this[s](u(),!0):this[s](u,!0)}n||this.__update()}else this[t](arguments[1],e)},get:function(t){return t?this[t]():this.getCopy()},getJson:function(){return this.__json},getCopy:function(t){for(var n,e,r={},s=o.keys(this.__json),u=0;u<s.length;u++)n=s[u],e=this.__json[n],this.__isProp(n)&&(e&&e.__model instanceof i?r[n]=e.__model.get():r[n]=e);return t?o.cloneDeep(r):r},save:function(t){var n=this,e=r.deferred(),i=this.id()?c.put:c.post;return i.call(c,this.url(),this).then(function(i){n.set(i),n.__saved=!0,e.resolve(n),o.isFunction(t)&&t(null,n)},function(n){e.reject(n),o.isFunction(t)&&t(n)}),e.promise},fetch:function(t){var n=this,e=r.deferred(),i=this.__getDataId();return i[s.keyId]?c.get(this.url(),i).then(function(i){n.set(i),n.__saved=!0,e.resolve(n),o.isFunction(t)&&t(null,n)},function(n){e.reject(n),o.isFunction(t)&&t(n)}):(e.reject(!0),o.isFunction(t)&&t(!0)),e.promise},destroy:function(t){var n=this,e=r.deferred(),i=this.__getDataId();return i[s.keyId]?c.destroy(this.url(),i).then(function(i){n.detach(),e.resolve(),o.isFunction(t)&&t(null),n.dispose()},function(n){e.reject(n),o.isFunction(t)&&t(n)}):(e.reject(!0),o.isFunction(t)&&t(!0)),e.promise},remove:function(){this.detach(),this.dispose()},detach:function(){for(var t=o.clone(this.__collections),n=0;n<t.length;n++)t[n].remove(this),t[n]=null},dispose:function(){var t,n=o.keys(this),e=this.options.props;for(this.__json.__model=null,t=0;t<e.length;t++)this[e[t]](null);for(t=0;t<n.length;t++)this[n[t]]=null},isSaved:function(){return this.__saved},isNew:function(){return!(this.id()&&this.__saved)},__update:function(t){var n;(this.__options.redraw||this.options.redraw||s.redraw)&&(r.startComputation(),n=!0);for(var e=0;e<this.__collections.length;e++)this.__collections[e].__update(this);n&&a.nextTick(r.endComputation)},__isProp:function(t){return o.indexOf(this.options.props,t)>-1},__getDataId:function(){var t={};return t[s.keyId]=this.id(),t},__gettersetter:function(t,n){function e(){var t;return arguments.length?(t=arguments[0],o.isPlainObject(t)&&s&&(t=new u[s](t)),t instanceof i&&(t=t.getJson()),r[n]=t,arguments[1]||this.__update(n),t):(t=r[n],t&&t.__model instanceof i&&(t=t.__model),t)}var r=this.__json,s=this.options.refs[n];return e.toJSON=function(){return r[n]},e(t,!0),e}},a.addMethods(i.prototype,o,h,"__json")},function(t,n,e){function i(t,n){c.storeConfigXHR&&c.storeConfigXHR(t,n),t.setRequestHeader("Content-Type","application/json")}function o(t,n){return c.storeExtract?c.storeExtract(t,n):t.responseText.length?t.responseText:null}function r(t){return t=t instanceof a?t.getCopy():t,c.storeSerializer?c.storeSerializer(t):JSON.stringify(t)}function s(t){if(c.storeDeserializer)return c.storeDeserializer(t);try{return JSON.parse(t)}catch(n){return t}}var u=e(1),c=e(3).config,a=e(4);t.exports=u.create(null,{request:function(t,n,e,a){var f={method:n||"GET",url:t,data:e||{},serialize:r,deserialize:s,config:i,extract:o};return a&&u.assign(f,a),c.storeConfigOptions&&c.storeConfigOptions(f),c.store(f)},get:function(t,n,e){return this.request(t,"GET",n,e)},post:function(t,n,e){return this.request(t,"POST",n,e)},put:function(t,n,e){return this.request(t,"PUT",n,e)},destroy:function(t,n,e){return this.request(t,"DELETE",n,e)}})},function(t,n,e){(function(n){function i(t,n){return function(e,i,o,r){return t(e?e[n]||e:e,i?i[n]||i:i,o,r)}}function o(t,n){for(var e,o=t.length-1;o>=0;o--)e=t[o],u.isFunction(e)?t[o]=i(e,n):e instanceof a&&(t[o]=e.__json);return t}function r(t,n,e){if(t===n)return t;if(u.isArray(t)){for(var i,o=t.length-1;o>=0;o--)i=t[o],i&&i[e]&&(t[o]=i[e]);return t}return t?t[e]||t:t}function s(){return f&&window.setImmediate?window.setImmediate:"object"==typeof n&&"function"==typeof n.nextTick?n.nextTick:function(t){setTimeout(t,0)}}var u=e(1),c=Array.prototype.slice,a=e(4),f="undefined"!=typeof window;t.exports=u.create(null,{isBrowser:f,nextTick:s(),clearObject:function(t){for(var n in t)delete t[n]},hasValueOfType:function(t,n){for(var e=u.keys(t),i=0;i<e.length;i++)if(t[e[i]]instanceof n)return!0;return!1},isConflictExtend:function(t,n,e){for(var i=u.keys(n),o=0;o<i.length;o++)if(u.hasIn(t,i[o]))return i[o];return!1},strictExtend:function(t,n){var e=this.isConflictExtend(t,n);if(e)throw new Error("`"+e+"` method / property is not allowed.");u.extend(t,n)},addMethods:function(t,n,e,s,f){u.each(e,function(e,l){if(n[l])switch(e){case 0:t[l]=function(){return r(n[l](this[s]),this[s],f)};break;case 1:t[l]=function(t){return u.isFunction(t)?t=i(t,f):t instanceof a&&(t=t.__json),r(n[l](this[s],t),this[s],f)};break;case 2:t[l]=function(t,e){return u.isFunction(t)?t=i(t,f):t instanceof a&&(t=t.__json),u.isFunction(e)?e=i(e,f):e instanceof a&&(e=e.__json),r(n[l](this[s],t,e),this[s],f)};break;default:t[l]=function(){var t=o(c.call(arguments),f);return t.unshift(this[s]),r(n[l].apply(n,t),this[s],f)}}})}})}).call(n,e(7))},function(t,n){function e(){a&&s&&(a=!1,s.length?c=s.concat(c):f=-1,c.length&&i())}function i(){if(!a){var t=setTimeout(e);a=!0;for(var n=c.length;n;){for(s=c,c=[];++f<n;)s&&s[f].run();f=-1,n=c.length}s=null,a=!1,clearTimeout(t)}}function o(t,n){this.fun=t,this.array=n}function r(){}var s,u=t.exports={},c=[],a=!1,f=-1;u.nextTick=function(t){var n=new Array(arguments.length-1);if(arguments.length>1)for(var e=1;e<arguments.length;e++)n[e-1]=arguments[e];c.push(new o(t,n)),1!==c.length||a||setTimeout(i,0)},o.prototype.run=function(){this.fun.apply(null,this.array)},u.title="browser",u.browser=!0,u.env={},u.argv=[],u.version="",u.versions={},u.on=r,u.addListener=r,u.once=r,u.off=r,u.removeListener=r,u.removeAllListeners=r,u.emit=r,u.binding=function(t){throw new Error("process.binding is not supported")},u.cwd=function(){return"/"},u.chdir=function(t){throw new Error("process.chdir is not supported")},u.umask=function(){return 0}},function(t,n,e){function i(t){this.models=[],this.__options={redraw:!1},t&&this.opt(t);var n=this.__options.state;n&&(n instanceof a||(n=new a(n)),this.__state=n),o.bindAll(this,o.union(f,u.collectionBindMethods))}var o=e(1),r=e(2),s=e(6),u=e(3).config,c=e(4),a=e(9);t.exports=i,i.prototype={opt:function(t,n){o.isPlainObject(t)?o.assign(this.__options,t):this.__options[t]=o.isUndefined(n)?!0:n},add:function(t,n,e){if(!(t instanceof c)||this.__options.model&&!(t instanceof this.__options.model))throw new Error("Must be a model or an instance of set model");var i=this.get(t),o=!1;return i?i.set(t):(n?this.models.unshift(t.getJson()):this.models.push(t.getJson()),t.attachCollection(this),this.__state&&this.__state.set(t.lid()),o=!0),o&&!e&&this.__update(),o},addAll:function(t,n,e){o.isArray(t)||(t=[t]);for(var i=!1,r=0;r<t.length;r++)this.add(t[r],n,!0)&&(i=!0);return i&&!e&&this.__update(),i},create:function(t){o.isArray(t)||(t=[t]);for(var n,e,i=[],r=0;r<t.length;r++){if(e=t[r],!o.isPlainObject(e))throw new Error("Plain object required");n=this.get(e),n?n.set(e,!0):this.__options.model&&i.push(new this.__options.model(e))}return this.addAll(i),i},get:function(t){var n;if(t instanceof c)return this.indexOf(t.getJson())>-1?t:void 0;if(o.isObject(t)){if(!t[u.keyId])return this.find(t)||void 0;t=t[u.keyId]}return n=this.find([u.keyId,t]),n||void 0},getAll:function(t,n){o.isArray(t)||(t=[t]);for(var e,i=[],r=0;r<t.length;r++)e=this.get(t[r]),(e||n)&&i.push(e);return i},remove:function(t,n){o.isArray(t)||(t=[t]);var e,i,r,s=this.size(),a=[];if(s){for(r=0;r<t.length;r++){if(i=t[r],!i)throw new Error("Can't remove from collection. Argument must be set.");i instanceof c?a.push.apply(a,o.remove(this.models,function(t){return o.eq(t,i.getJson())})):o.isObjectLike(i)?a.push.apply(a,o.remove(this.models,function(t){return o.isMatch(t,i)})):a.push.apply(a,o.remove(this.models,function(t){return e={},e[u.keyId]=i,o.isMatch(t,e)}))}var f;for(r=0;r<a.length;r++)f=a[r].__model,f.detachCollection(this),this.__state&&this.__state.remove(f.lid());return s!==this.size()?(n||this.__update(),!0):!1}},push:function(t,n){return this.addAll(t,n)},unshift:function(t,n){return this.addAll(t,!0,n)},shift:function(t){var n=this.first();return this.remove(n,t),n},pop:function(t){var n=this.last();return this.remove(n,t),n},clear:function(t){return this.remove(this.toArray(),t)},pluck:function(t){for(var n=[],e="id"===t,i=0,o=this.models;i<o.length;i++)n.push(e?o[i].__model[t]():o[i][t]);return n},dispose:function(){var t=o.keys(this),n=0;for(this.__options.model&&(this.__options.model=null);n<t.length;n++)this[t[n]]=null},destroy:function(){this.clear(!0),this.dispose()},stateOf:function(t){if(this.__state){var n=this.get(t);if(n)return this.__state.get(n.lid())}},contains:function(t){if(t instanceof c)return this.indexOf(t.getJson())>-1;if(o.isObject(t)){if(!t[u.keyId])return this.findIndex(t)>-1;t=t[u.keyId]}return this.findIndex([u.keyId,t])>-1},hasModel:function(){return!!this.__options.model},model:function(){return this.__options.model},url:function(t){var n=t?"":u.baseUrl;return this.__options.url?n+=this.__options.url:this.hasModel()&&(n+=this.model().modelOptions.url||"/"+this.model().modelOptions.name.toLowerCase()),n},fetch:function(t,n,e){o.isFunction(n)&&(e=n,n=void 0);var i=r.deferred();if(this.hasModel){var s=this;this.model().pull(this.url(),t,n).then(function(t){s.addAll(t),i.resolve(s),o.isFunction(e)&&e(null,s)},function(t){i.reject(t),o.isFunction(e)&&e(t)})}else i.reject(!0),o.isFunction(e)&&e(!0);return i.promise},__update:function(){(this.__options.redraw||u.redraw)&&(r.startComputation(),s.nextTick(r.endComputation))}};var f=[],l={forEach:1,map:1,find:1,findIndex:1,findLastIndex:1,filter:1,reject:1,every:1,some:1,invoke:3,maxBy:1,minBy:1,sortBy:1,groupBy:1,shuffle:0,size:0,initial:0,without:1,indexOf:2,lastIndexOf:2,difference:1,sample:0,reverse:0,nth:1,first:0,last:0,toArray:0,slice:1,orderBy:2,transform:2};s.addMethods(i.prototype,o,l,"models","__model")},function(t,n,e){function i(t){if(o.isArray(t)){this.signature=o.invert(t);for(var n in this.signature)this.signature[n]=void 0}else this.signature=t;this.map={}}var o=e(1),r=e(2),s="__key__";t.exports=i,i.create=function(t){var n={};for(var e in t)n[e]=r.prop(t[e]);return n},i.prototype={set:function(t){if(t||(t=s),!this.map[t]){this.map[t]={factory:r.prop(this)};for(var n in this.signature){if("factory"===n)throw new Error("State key `factory` is not allowed.");this.map[t][n]=r.prop(this.signature[n])}}return this.map[t]},get:function(t){return t||(t=s),this.map[t]||this.set(t),this.map[t]},remove:function(t){if(t||(t=s),this.map[t]){var n,e=o.keys(this.map[t]);for(n=0;n<e.length;n++)this.map[t][e[n]]=null;delete this.map[t]}},dispose:function(){var t,n,e=o.keys(this),i=o.keys(this.map),r=o.keys(this.signature);for(t=0;t<i.length;t++){for(n=0;n<r.length;n++)this.map[i[t]][r[n]]=null;this.map[i[t]]=null}for(t=0;t<e.length;t++)this[e[t]]=null}}},function(t,n,e){function i(){}var o=e(5),r=e(8);t.exports=i,i.prototype={__init:function(t){this.__options||(this.__options={redraw:!1},t&&this.opt(t))},__flagSaved:function(t){for(var n=0;n<t.length;n++)t[n].__saved=!0},opt:function(t,n){this.__options||this.__init(),_.isPlainObject(t)?_.assign(this.__options,t):this.__options[t]=_.isUndefined(n)?!0:n},createCollection:function(t){return new r(_.assign({model:this},t))},createModels:function(t){_.isArray(t)||(t=[t]);for(var n=0;n<t.length;n++){if(!_.isPlainObject(t[n]))throw new Error("Plain object required");t[n]=new this(t[n])}return t},pull:function(t,n,e,i){_.isFunction(n)?(i=n,n=void 0):_.isFunction(e)&&(i=e,e=void 0);var r=this,s=m.deferred();return o.get(t,n,e).then(function(t){var n=r.createModels(t);r.__flagSaved(n),s.resolve(n),_.isFunction(i)&&i(null,n)},function(t){s.reject(t),_.isFunction(i)&&i(t)}),s.promise}}}]);